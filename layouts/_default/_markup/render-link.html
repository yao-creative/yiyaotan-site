{{/* On Work index: show link text, then try to embed as iframe unless blocked by domain or file type. */}}
{{ $dest := .Destination }}
{{ $isWorkIndex := or (eq .Page.RelPermalink "/work/") (strings.HasSuffix (lower .Page.File.Path) "/content/work/_index.md") }}
{{ $isPDF := or (strings.HasSuffix (lower $dest) ".pdf") (in (lower $dest) ".pdf?") }}
{{ $isSpotify := in (lower $dest) "open.spotify.com" }}
{{ $u := urls.Parse $dest }}
{{ $host := cond $u $u.Host "" }}
{{ $blockedHosts := slice "substack.com" "medium.com" "x.com" "twitter.com" "linkedin.com"}}
{{ $isBlockedHost := false }}
{{ range $blockedHosts }}
  {{ if or (eq $host .) (strings.HasSuffix $host (printf ".%s" .)) }}
    {{ $isBlockedHost = true }}
  {{ end }}
{{ end }}

<div class="embed-link">
  <div class="embed-caption"><a href="{{ .Destination }}" {{ with .Title}}title="{{ . }}"{{ end }}>{{ .Text | safeHTML }}</a></div>
  {{ if and $isWorkIndex (not $isPDF) (not $isSpotify) (not $isBlockedHost) }}
    <div class="embed-frame">
      <iframe style="border-radius:12px;border:none;" src="{{ $dest }}" width="100%" height="480" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
  {{ end }}
</div>


